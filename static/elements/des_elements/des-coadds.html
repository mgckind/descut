<dom-module id="des-coadds">
<template>
    <style>
       paper-button.blue {
    width:200px;
    font-size: 14pt;
      color: var(--paper-blue-500);
      --paper-button-flat-focus-color: var(--paper-blue-50);
    }
    paper-button.blue:hover {
      background: var(--paper-blue-50);
    } 
    paper-card {
        margin-top: 0px;
    }
    paper-input {
    width: 300px;
    min-width: 200px;
    }
    
   paper-slider {
    width:100%;
    }

.caption {
    padding-left: 12px;
    color: #a0a0a0;
  }
 .upload{
      position: absolute;
      opacity: 0;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
    }
  
    </style>

    <section>

    <paper-card heading = "Coadd Images Cutout Form">
    <div class="card-content">
    Upload the file with the positions or enter the positions by hand and run the desthumb generator
    </div>
    <div class="card-content">
    <div class="horizontal layout around-justified" >
    <paper-button raised  class="blue"  id="uploadFile">
    <div id ="uploadicon" style="display: inline-block;"> <i class="fa fa-cloud-upload"></i>&nbsp;  &nbsp;</div>
    <span style="overflow-x: auto; overflow-wrap: break-word;">[[file_name]]</span>
    <input type="file" class="upload" id="file" on-change="_fileChange"/>
    </paper-button>
    <paper-button raised  class="blue" id="enterValues" on-tap="_openPositions">
    <div id ="keyboardicon" style="display: inline-block;"> <i class="fa fa-keyboard-o"></i> &nbsp;  &nbsp;</div>
    <span>[[enter_values]]</span>
    </paper-button>
    </div>
    <hr>
    <div>xsize (arcmin): <span id="xsizeLabel" class="caption">1.0</span></div><br>
    <paper-slider id="xsizeSlider" pin  max="10" max-markers="10" step="0.1" value="1" expand></paper-slider>
    <div>ysize (arcmin): <span id="ysizeLabel" class="caption">1.0</span></div><br>
    <paper-slider id="ysizeSlider" pin  max="10" max-markers="10" step="0.1" value="1"></paper-slider>
    <hr>
    <paper-checkbox id="onlyreturnlist">Return just list of files (do not produce and display pngs, i.e. faster)</paper-checkbox>
    <hr>
    <div class=" horizontal center layout justified" >
   <paper-checkbox style="font-size:14px;" id="sendemail" on-change="emailcheck">Send email after job completion </paper-checkbox>
       <paper-input  id="validemail" name="email" label="Email" value="[[email]]">
    </paper-input>
    </div>
    <hr> 
    <div class="horizontal layout around-justified" >
    <paper-button raised  class="blue"  id="submitJobButton" disabled on-tap="_submitJob">
    <i class="fa fa-cogs"></i> &nbsp;  &nbsp;Submit Job </paper-button>
    </div>
    </div>

    </paper-card>

    <des-positions id="desPositions"></des-positions>
    <paper-toast class="toast-position" id="toast1" text="Job has been submitted!" duration="5000"> </paper-toast>
    <paper-toast class="toast-position" id="toast2" text="ERROR!. There was an error. Please try again" duration="5000"> </paper-toast>
    
    </section>
</template>

<script>

 document.addEventListener('WebComponentsReady', function() {
    var xsize = document.querySelector('#xsizeSlider');
    xsize.addEventListener('value-change', function() {
      document.querySelector('#xsizeLabel').textContent = xsize.value;
        });
    var ysize = document.querySelector('#ysizeSlider');
    ysize.addEventListener('value-change', function() {
      document.querySelector('#ysizeLabel').textContent = ysize.value;
        });
    });

      Polymer({
      is: "des-coadds",
        properties: {
            file_name : {
                type : String,
                value : "Upload File"
            },
            enter_values : {
                type : String,
                value : "Enter Values"
            },
            submit_type : {
                type: String,
                value: "csvfile",
                },
    },
    get file(){
      return this.$.file.files[0]
    },
    _fileChange: function(){
      this.file_name = this.file.name;
      console.log('File to read : ' + this.file_name );
      document.getElementById("submitJobButton").disabled=false;
      document.getElementById("enterValues").disabled=true;
      document.getElementById("uploadicon").style.display='none';
      this.submit_type = 'csvfile';
    },
    clear: function(){
        document.getElementById("submitJobButton").disabled=true;
        document.getElementById("enterValues").disabled=false;
        document.getElementById("uploadFile").disabled=false;
        document.getElementById("keyboardicon").style.display='inline-block';
        document.getElementById("xsizeSlider").value="1";
        document.getElementById("ysizeSlider").value="1";
        document.getElementById("sendemail").checked=false;
        document.getElementById("onlyreturnlist").checked=false;
        document.getElementById("desPositions").clear();
      this.file_name = "Upload File";
      var upIcon = document.getElementById("uploadicon").style.display='inline-block';
     this.enter_values = "Enter Values";
      //$('#dothis')[0].checked=false;
      this.$.file.value = "";
    },
    _openPositions: function(){
        var inputDialog = document.getElementById("inputValuesDialog");
        inputDialog.open();
        this.submit_type = 'manual';
        },
    completeHandler: function(){
        console.log('YESSSSS');
        document.getElementById('desCoadds').clear();
        document.getElementById("getData").generateRequest();
        document.querySelector('#toast1').show();
        },
    errorHandler: function(){
        console.log('NOOOO');
        document.getElementById('desCoadds').clear();
        document.querySelector('#toast2').show();
        },
    _submitJob: function(event){
        var formdata = new FormData();
        formdata.append('csvfile', this.$.file.files[0]);
        formdata.append('xsize', document.getElementById("xsizeSlider").value);
        formdata.append('ysize', document.getElementById("ysizeSlider").value);
        formdata.append('list_only', document.getElementById("onlyreturnlist").value);
        formdata.append('send_email', document.getElementById("sendemail").value);
        formdata.append('email', document.getElementById("validemail").value);
        formdata.append('submit_type', this.submit_type);
        formdata.append('values',document.getElementById("enteredPositions").value);
        $.ajax({
             url: '/readfile/',  //Server script to process data
             type: 'POST',
             //beforeSend: this.beforeSendHandler,
             success: this.completeHandler,
             error: this.errorHandler,
             // Form data
             data: formdata,
             //Options to tell jQuery not to process data or worry about content-type.
             cache: false,
             contentType: false,
             processData: false
          });
    },
    });


</script>
</dom-module>
